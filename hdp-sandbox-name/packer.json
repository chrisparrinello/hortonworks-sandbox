{
  "builders": [{
    "type": "docker",
    "image": "{{user `docker-repo`}}/sandbox-hdf-streaming-pre:{{user `version`}}",
    "author": "eorendain@hortonworks.com",
    "pull": false,
    "commit": true,
    "privileged": true,
    "run_command": ["-itd", "-h", "sandbox-hdf.hortonworks.com", "{{.Image}}", "/usr/sbin/init"]
  }],

  "provisioners":
    [
      {
        "type": "shell",
        "inline": [
          "mkdir -p /tmp/sandbox/build",
          "/sandbox/ambari/wait-for-ambari.sh"
        ],
        "execute_command": "{{ .Vars }} /bin/bash -vx {{ .Path }}"
      },
      {
        "type": "file",
        "source": "assets/",
        "destination": "/tmp/sandbox/build"
      },
      {
        "type": "shell",
        "scripts": [
          "scripts/mysql-setup.sh",
          "scripts/deploys/blueprint-deploy.sh",
          "scripts/deploys/registry-deploy.sh",
          "scripts/deploys/kafka-deploy.sh",
          "scripts/deploys/storm-deploy.sh",
          "scripts/deploys/nifi-deploy.sh",
          "scripts/deploys/sam-deploy.sh"
        ],
        "execute_command": "{{ .Vars }} /bin/bash -vx {{ .Path }}"
      },
      {
        "type": "shell",
        "scripts": [
          "scripts/views-create.sh",
          "scripts/version-set.sh",
          "scripts/hdf-directory-cleanup.sh",
          "scripts/service-cycle.sh",
          "scripts/nifi-ssl-files.sh",
          "scripts/maintenance-mode.sh"
        ],
        "execute_command": "{{ .Vars }} /bin/bash -vx {{ .Path }}"
      },
      {
        "type": "shell",
        "scripts": [
          "scripts/tutorials/tutorial-setup.sh",
          "scripts/tutorials/640.sh",
          "scripts/tutorials/tutorial-cleanup.sh"
        ],
        "execute_command": "{{ .Vars }} /bin/bash -vx {{ .Path }}"
      },
      {
        "type": "shell",
        "inline": [
          "systemctl enable sandbox-ambari-services",
          "rm -rf /tmp/sandbox/build"
        ],
        "execute_command": "{{ .Vars }} /bin/bash -vx {{ .Path }}"
      }
    ],

  "post-processors": [
    {
      "type": "docker-tag",
      "repository": "{{user `docker-repo`}}/sandbox-hdf-streaming",
      "tag": "{{user `version`}}"
    }
  ]
}
